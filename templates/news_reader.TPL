<!doctype html><html><head><title>news_reader.php</title><script>function mouseMove(ID){	if (ID=="user_panel")			document.getElementById(ID).			innerHTML="<img src=\"./img/user_panel_mini_button_on.png\" alt=\"user_panel\"\>"	else if (ID=="register_news")			document.getElementById(ID).			innerHTML="<img src=\"./img/register_news_mini_button_on.png\" alt=\"insert_news\"\>"	else if (ID=="login")			document.getElementById(ID).			innerHTML="<img src=\"./img/login_button_on.png\" alt=\"insert_news\"\>"	else if (ID=="register")			document.getElementById(ID).			innerHTML="<img src=\"./img/register_button_on.png\" alt=\"insert_news\"\>"		}//end mouseMovefunction mouseLeave(ID){	if (ID=="user_panel")			document.getElementById(ID).			innerHTML="<img src=\"./img/user_panel_mini_button_off.png\" alt=\"user_panel\"\>"	else if (ID=="register_news")			document.getElementById(ID).			innerHTML="<img src=\"./img/register_news_mini_button_off.png\" alt=\"insert_news\"\>"	else if (ID=="login")			document.getElementById(ID).			innerHTML="<img src=\"./img/login_button.png\" alt=\"insert_news\"\>"	else if (ID=="register")			document.getElementById(ID).			innerHTML="<img src=\"./img/register_button.png\" alt=\"insert_news\"\>"	}//end mouseLeave</script></head><body>		<table align=1  border=0 id="main" 	style="table-layout: fixed;	"	align="center">		<tr><td align=center	style="		background-image: url(./img/user_panel_banner.png);	background-position: center; 	background-repeat: no-repeat;	text-align: center;	background-size: cover;	position: relative;"	>		{if !isset($unknown)}	<table border=4 align="center"><tr><td>	===&nbsp{$viewer}&nbsp===	</td></tr></table>		<button align=center type="button" id="user_panel"	onClick="location.href='user_panel.php'"	style=";border: 0; background: transparent"	onmousemove="mouseMove(this.id)"	onmouseleave="mouseLeave(this.id)"	>	<img src="./img/user_panel_mini_button_off.png" alt="home" />	</button>		<button align=center id="register_news" type="button" 	onClick="location.href='register_news.php'"	style=";border: 0; background: transparent"	onmousemove="mouseMove(this.id)"	onmouseleave="mouseLeave(this.id)"	>	<img src="./img/register_news_mini_button_off.png" alt="home"/>	</button>	{else}	<!--- login button, register button -->	<button align=center id="register" type="button" 	onClick="location.href='register.php'"	style=";border: 0; background: transparent"	onmousemove="mouseMove(this.id)"	onmouseleave="mouseLeave(this.id)"	>	<img src="./img/register_button.png" alt="register"/>	</button>			<button align=center type="button" id="login"	onClick="location.href='login.php'"	style=";border: 0; background: transparent"	onmousemove="mouseMove(this.id)"	onmouseleave="mouseLeave(this.id)"	>	<img src="./img/login_button.png" alt="login" />	</button>			{/if}		</td></tr>	{foreach from=$allNews key=i item=news}	{assign newsId $news[0]}	{assign title $news[1]}	{assign context $news[2]}	{assign owner $news[3]}	{assign likeCount $news[4]}	{assign date $news[5]}			<tr id="mainTr_{$newsId}" width="20%"><td width="20%">	<table border="0" align="center" 	style="		background-image: url(./img/context_back.png);	background-position: center; 	background-repeat: no-repeat;	text-align: center;	background-size: cover;	width:100%; 	height:100%;	position: relative;	">		<tr><td style="	background-image: url(./img/title_back.png);	background-position: center; 	background-repeat: no-repeat;	background-size: 100% auto;	width:100%;	height:100%;	position: relative;	">	<b>	<div id="title_{$newsId}">	{$title} 	</div>	{if $likeCount gte 0 }	<div id="likeCount_{$newsId}">	<font color="White"> {$likeCount} </font>	</div>	{else}	<div id="likeCount_{$newsId}">	<font color="red"> {$likeCount} </font>	</div>	{/if}	</b>	</tr></td>	<tr><td>&nbsp&nbsp</td></tr>	<tr><td>	<table border=0 align="center">	<tr><td align="center" style="	display:block;	text-align:center;	width:100% auto;	height:100% auto;	word-wrap:break-all;	"><center>	<div id="context_{$newsId}" >	{$context}	</div>	</center>	</tr></td>	</td></tr>	</table>	</td></tr>	<tr><td id="owner" align="center" style="font-size:80%">	<br><br><font color="pink">	Writen by&nbsp{$owner}&nbspat&nbsp{$date}	</font>	</td></tr>	<tr><td id="buttons" align="center">	<table align=center border=0 >	<br>	<tr  id="buttonContainer" style="display:flex" >	<td>	{if isset($news[6]) && $news[6]==1}	<button id="like_{$newsId}" type="button" 	onClick="likeClick(this.id)"	style="border: 0; background: transparent;"	>	<img src="./img/like_circle_button_on.png" style="max-width:65%" alt="like"/>	</td>	{else}	<button id="like_{$newsId}" type="button" 	onClick="likeClick(this.id)"	style="border: 0; background: transparent;"	>	<img src="./img/like_circle_button_off.png" style="max-width:65%" alt="like"/>	</button>	</td>	{/if}		<td>	{if isset($news[6]) && $news[6]==-1}	<button id="dislike_{$newsId}" type="button" 	onClick="likeClick(this.id)"	style="border: 0; background: transparent"	>	<img src="./img/dislike_circle_button_on.png" style="max-width:65%" alt="dislike"/>	</td>	{else}	<button id="dislike_{$newsId}" type="button" 	onClick="likeClick(this.id)"	style="border: 0; background: transparent"	>	<img src="./img/dislike_circle_button_off.png" style="max-width:65%" alt="dislike"/>	</button>	</td>	{/if}		{if ($viewer eq $owner) || isset($admin)}	<td>	<button id="edit_{$newsId}" type="button" 	onClick="editClick(this.id)"	style="border: 0; background: transparent"	>	<img src="./img/edit_circle_button.png" style="max-width:65%" alt="like"/>	</button>	</td>	<td>	<button id="delete_{$title}_{$newsId}" type="button" 	onClick="deleteClick(this.id)"	style="border: 0; background: transparent"	>	<img src="./img/delete_circle_button.png" style="max-width:65%" alt="like"/>	</button>		</td>	{/if}	{if $more[$i] eq 1}	<td>	<button type="button" id="more_{$newsId}" onClick="moreClick({$newsId})"	style="border: 0; background: transparent"	>	<img src="./img/more_circle_button.png" style="max-width:65%" alt="more"/>	</button>	</td>	{/if}		</tr>	</table>	</tr></td>	</table></td></tr>	{/foreach}	<table><script>		function moreClick(ID){					var req=new XMLHttpRequest()			req.onreadystatechange=function(){							if (req.readyState==4 && req.status==200){									document.getElementById('more_'+ID).parentNode.remove()					document.getElementById('context_'+ID).innerHTML=					req.responseText.replace(/(?:\r\n|\r|\n)/g, '<br />');								}//response ready				}//end onready ...						req.open("GET","news_reader.php?more="+ID,true)			req.send()		}				function deleteClick(ID){			splitedId=ID.split("_")			var newsId=splitedId[splitedId.length-1]			var title=splitedId[splitedId.length-2]			var req=new XMLHttpRequest()			req.onreadystatechange=function(){						if (req.readyState==4 && req.status==200){									//remove table element					if (req.responseText=="1"){						var element=document.getElementById("mainTr_"+newsId);										if (element)							element.parentNode.removeChild(element)					}				}//response ready				}//end onready ...						req.open("GET","edit_news.php?delete="+newsId,true)			var ask=confirm("Are you sure you wan't to delete "+title+" ?")			if (ask)				req.send()					}						function like_dislike(newsId,likeOrDislike){						var req=new XMLHttpRequest()			req.onreadystatechange=function (){					if (req.readyState==4 && req.status==200){											//update like count							if (req.responseText>=0)							var likeCountContent=							"<font color=\"White\">"+req.responseText+"</font>"						else							var likeCountContent=							"<font color=\"Red\">"+req.responseText+"</font>"													document.getElementById("likeCount_"+newsId).innerHTML=likeCountContent											}//end if response ready			}//end onready state change function			req.open("GET","like_response.php?"+likeOrDislike+"="+newsId,true)			req.send()					}//end like_dislike				function likeClick(ID){		var newsId=ID.split("_")[ID.split("_").length-1]		if (document.getElementById(ID).innerHTML.search("off")!=-1){			if (document.getElementById(ID).innerHTML.search("dis")!=-1){				like_dislike(newsId,"dislike")								document.getElementById(ID).innerHTML=				"<img src=\"./img/dislike_circle_button_on.png\" style=\"max-width:65%\" alt=\"like\"/>"				document.getElementById(ID.substr(3)).innerHTML=				"<img src=\"./img/like_circle_button_off.png\" style=\"max-width:65%\" alt=\"like\"/>"											}else{				like_dislike(newsId,"like")				document.getElementById(ID).innerHTML=				"<img src=\"./img/like_circle_button_on.png\" style=\"max-width:65%\" alt=\"like\"/>"								document.getElementById("dis"+ID).innerHTML=				"<img src=\"./img/dislike_circle_button_off.png\" style=\"max-width:65%\" alt=\"like\"/>"							}//end else dis 		}else{						if (document.getElementById(ID).innerHTML.search("dis")!=-1){				like_dislike(newsId,"dislike")				document.getElementById(ID).innerHTML=				"<img src=\"./img/dislike_circle_button_off.png\" style=\"max-width:65%\" alt=\"like\"/>"				}			else{				like_dislike(newsId,"like")				document.getElementById(ID).innerHTML=				"<img src=\"./img/like_circle_button_off.png\" style=\"max-width:65%\" alt=\"like\"/>"				}				}					}//end likeClick				function getContextFromServer(newsId){					var req=new XMLHttpRequest()			req.open("GET","edit_news.php?getContext="+newsId,false)			req.send();			return req.responseText				}//end get context from server				function getMoreLimit(){					var req=new XMLHttpRequest()			req.open("GET","edit_news.php?getMoreLimit=1",false)			req.send();				return req.responseText				}//end get context from server				function editClick(ID){			editClick.editFlag=(++editClick.editFlag)%2||0			splitedId=ID.split("_")			var newsId=splitedId[splitedId.length-1]						if (!editClick.editFlag){			//var context=document.getElementById('context_'+newsId).innerHTML			var context=getContextFromServer(newsId)			context=context.trim()			if (context.length>1000){				var rows=12				var cols=50			}else{				var rows=7				var cols=50			}			var title=document.getElementById('title_'+newsId).innerHTML			title=title.trim()			document.getElementById(ID).innerHTML=			"<img src=\"./img/save_circle_button.png\" style=\"max-width:65%\" alt=\"save\"/>"						document.getElementById('context_'+newsId).			innerHTML="<textarea rows=\""+rows+"\" cols=\""+cols			+"\"id=\"editContext_"+newsId+"\" >"+context+"</textarea>"						document.getElementById('title_'+newsId).innerHTML=			"<input style=\"text-align:center;\" id=\"editTitle_"			+newsId+"\" type=\"text\" value=\""+			title+"\"> </input>"			}//end if edit flag			else{						document.getElementById(ID).innerHTML=			"<img src=\"./img/edit_circle_button.png\" style=\"max-width:65%\" alt=\"edit\"/>"			var title=document.getElementById("editTitle_"+newsId).value;			var context=document.getElementById("editContext_"+newsId).value;			var req=new XMLHttpRequest()			var reqParams=			"title="+encodeURIComponent(title)+			"&context="+encodeURIComponent(context)+			"&newsId="+encodeURIComponent(newsId)			//alert(reqParams)			req.open("POST","edit_news.php",false)			req.setRequestHeader("Content-type","application/x-www-form-urlencoded")			req.setRequestHeader("Content-Length",reqParams.length)			//req.setReqestHeader("Connection","close")			req.send(reqParams)						document.getElementById('title_'+newsId).innerHTML=title			moreLimit=getMoreLimit()			miniContext=context.substr(0,moreLimit)						if (context.length>moreLimit &&				!document.getElementById("more_"+newsId) ){								/*var htmlContent="<button type=\"button\" id=\"more_"+newsId+ 				" onClick=\"moreClick("+newsId+")\" style=\"border: 0;"+ 				"background: transparent\">"+				"<img src=\"./img/more_button.png\" alt=\"more\"/></button>";				*/								buttonTr=document.getElementById("buttonContainer")								var cell=buttonTr.insertCell()				var btn=document.createElement("BUTTON")				var img=document.createElement("img")												img.src="./img/more_circle_button.png"				img.style.maxWidth="65%"				btn.appendChild(img)				btn.id="more_"+newsId				btn.style.border="0"								btn.style.background="transparent"				btn.addEventListener("click",function() {				moreClick(newsId) 				})								cell.appendChild(btn)										}else if (context.length<moreLimit) {							var element=document.getElementById("more_"+newsId);							if (element)						element.parentNode.removeChild(element)								}						document.getElementById('context_'+newsId).innerHTML=			miniContext.replace(/(?:\r\n|\r|\n)/g, '<br />')			}					}        function autoResizeDiv()        {            document.getElementById('main').style.height = window.innerHeight*0.9 +'px';            document.getElementById('main').style.width = window.innerWidth *0.9+'px';        }        window.onresize = autoResizeDiv;        autoResizeDiv();</script></body></html>